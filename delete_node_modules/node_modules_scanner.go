package main

import (
	"fmt"
	"io/fs"
	"os"
	"path/filepath"
)

// Recursively delete node_modules directories in a path
func scanAndDelete(dir string) error {
	return filepath.WalkDir(dir, func(path string, dEntry fs.DirEntry, err error) error {
		fmt.Println("Visiting ", path)
		if err != nil {
			fmt.Println("Something went wrong when visiting ", path)
			return err
		}

		if dEntry.IsDir() && dEntry.Name() == "node_modules" {
			fmt.Println("Deleting ", path)
			rmErr := os.RemoveAll(path)
			if rmErr != nil {
				return fmt.Errorf("error removing %q: %v", path, rmErr)
			}

			return fs.SkipDir // do not walk deleted dir
		}

		return nil
	})
}
